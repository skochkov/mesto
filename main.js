(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n,r,o,i){var u,a,c=this,s=r.handleCardDelete,l=r.handleCardLike;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=function(){c._element=c._getTemplate(),c._setEventListeners();var e=c._element.querySelector(".element__image");return e.src=c._image,e.alt=c._title,c._element.querySelector(".element__title").textContent=c._title,c._element.querySelector(".element__like-counter").textContent=c._likes.length,c._getView(),c._element},(u="render")in this?Object.defineProperty(this,u,{value:a,enumerable:!0,configurable:!0,writable:!0}):this[u]=a,this._title=e.name,this._image=e.link,this._likes=e.likes,this._ownerId=e.owner._id,this._handleCardCkick=n,this._handleCardDelete=s,this._handleCardLike=l,this._currentId=o,this._template=i}var n,r;return n=t,(r=[{key:"_getTemplate",value:function(){return document.querySelector(this._template).content.querySelector(".element").cloneNode(!0)}},{key:"_getView",value:function(){this._ownerId===this._currentId&&this._element.querySelector(".element__trash").classList.add("element__trash_show")}},{key:"_setEventListeners",value:function(){var e=this;this._element.querySelector(".element__trash").addEventListener("click",(function(){e._handleCardDelete()})),this._element.querySelector(".element__like").addEventListener("click",(function(){e._handleCardLike()})),this._element.querySelector(".element__image").addEventListener("click",(function(){e._handleCardCkick(e._title,e._image)}))}},{key:"handlerDelete",value:function(){this._element.remove(),this._element=null}},{key:"setLike",value:function(e){var t=this;this._isLiked=e.likes.filter((function(e){return e._id==t._currentId})).length>0,this._element.querySelector(".element__like-counter").textContent=e.likes.length,this._isLiked?this._element.querySelector(".element__like").classList.add("element__like_status_active"):this._element.querySelector(".element__like").classList.remove("element__like_status_active")}},{key:"isLiked",value:function(){return this._isLiked}}])&&e(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formSelector=t.formSelector,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._form=document.querySelector(n),this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector)),this._buttonElement=this._form.querySelector(this._submitButtonSelector)}var t,r;return t=e,(r=[{key:"resetValidation",value:function(){var e=this;this._toggleButtonState(),this._inputList.forEach((function(t){return e._hideMessageError(t)}))}},{key:"_setInputEventListeners",value:function(){var e=this;this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._toggleButtonState()}))}))}},{key:"_checkInputValidity",value:function(e){var t=e.validity.valid,n=e.validationMessage;t?this._hideMessageError(e):this._showMessageError(e,n)}},{key:"_toggleButtonState",value:function(){this._inputList.some((function(e){return!e.validity.valid}))?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled",!0))}},{key:"_showMessageError",value:function(e,t){var n=e.closest(".popup__section").querySelector(".popup__input-error");n.textContent=t,n.classList.add(this._errorClass),e.classList.add(this._inputErrorClass)}},{key:"_hideMessageError",value:function(e){var t=e.closest(".popup__section").querySelector(".popup__input-error");t.textContent="",t.classList.remove(this._errorClass),e.classList.remove(this._inputErrorClass)}},{key:"enableValidation",value:function(){this._setInputEventListeners()}}])&&n(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,n){var r=t.data,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._initialArray=r,this._renderer=o,this._container=n}var t,n;return t=e,(n=[{key:"renderItems",value:function(){var e=this;this._initialArray.forEach((function(t){return e._renderer(t)}))}},{key:"setItem",value:function(e){this._container.append(e)}}])&&o(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"setEventListeners",value:function(){var e=this;this._popup.addEventListener("click",(function(t){t.target.classList.contains("popup_opened")&&e.close(),t.target.classList.contains("popup__button-close")&&e.close()}))}}])&&u(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=f(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},l.apply(this,arguments)}function f(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}function p(e,t){return p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},p(e,t)}function h(e,t){if(t&&("object"===c(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function _(e){return _=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_(e)}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_(r);if(o){var n=_(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return h(this,e)});function u(e){var t,n=e.popupSelector,r=e.handlerFormSubmit;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,n))._handlerFormSubmit=r,t._form=t._popup.querySelector(".popup__form"),t._inputs=Array.from(t._form.querySelectorAll(".popup__input")),t}return t=u,(n=[{key:"_getInputValues",value:function(){var e=this;return this._inputsValues={},this._inputs.forEach((function(t){return e._inputsValues[t.name]=t.value})),this._inputsValues}},{key:"setEventListeners",value:function(){var e=this;l(_(u.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){t.preventDefault(),e._handlerFormSubmit(e._getInputValues())}))}},{key:"loading",value:function(e){this._form.querySelector(".popup__button-save").textContent=e?"Сохранение...":"Сохранить"}},{key:"close",value:function(){l(_(u.prototype),"close",this).call(this),this._form.reset()}}])&&s(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(a);function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(){return m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=b(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},m.apply(this,arguments)}function b(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}function g(e,t){return g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},g(e,t)}function k(e,t){if(t&&("object"===d(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function w(e){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},w(e)}var S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=w(r);if(o){var n=w(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return k(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e))._popupImg=t._popup.querySelector(".popup__img"),t._popupTitle=t._popup.querySelector(".popup__title"),t}return t=u,(n=[{key:"open",value:function(e,t){this._popupImg.src=t,this._popupImg.alt=e,this._popupTitle.textContent=e,m(w(u.prototype),"open",this).call(this)}}])&&v(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(a);function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var C=function(){function e(t){var n=t.userName,r=t.userInfo;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._userName=n,this._userInfo=r}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{userName:this._userName.textContent,userInfo:this._userInfo.textContent}}},{key:"setUserInfo",value:function(e){this._userName.textContent=e.name,this._userInfo.textContent=e.job}}])&&E(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),O={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button-save",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_state_error",errorClass:"popup__input-error_active"};function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var L=function(){function e(t){var n=t.requestUrl,r=t.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._requestUrl=n,this._headers=r}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return fetch("".concat(this._requestUrl,"users/me"),{headers:this._headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))}},{key:"getCards",value:function(){return fetch("".concat(this._requestUrl,"cards"),{headers:this._headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))}},{key:"setUserInfo",value:function(e){return fetch("".concat(this._requestUrl,"users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.job})}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))}},{key:"createCard",value:function(e){var t=e.name,n=e.link;return fetch("".concat(this._requestUrl,"cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:n})}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))}},{key:"deleteCard",value:function(e){return fetch("".concat(this._requestUrl,"cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))}},{key:"likeCard",value:function(e){return fetch("".concat(this._requestUrl,"cards/").concat(e,"/likes"),{method:"PUT",headers:this._headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))}},{key:"dislikeCard",value:function(e){return fetch("".concat(this._requestUrl,"cards/").concat(e,"/likes"),{method:"DELETE",headers:this._headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))}},{key:"setAvatar",value:function(e){var t=e.avatar;return fetch("".concat(this._requestUrl,"users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))}}])&&j(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(){return I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=R(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},I.apply(this,arguments)}function R(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=U(e)););return e}function T(e,t){return T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},T(e,t)}function x(e,t){if(t&&("object"===P(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function U(e){return U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},U(e)}var B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&T(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=U(r);if(o){var n=U(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return x(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e))._form=t._popup.querySelector(".popup__form"),t}return t=u,(n=[{key:"setEventListeners",value:function(){var e=this;I(U(u.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){t.preventDefault(),e.setFormSubmitHandler()}))}},{key:"setFormSubmitHandler",value:function(e){this.setFormSubmitHandler=e}}])&&q(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(a),V=document.querySelector(".profile-info__edit-button"),D=document.querySelector(".profile__add-button"),A=document.querySelector(".popup__input_type_name"),N=document.querySelector(".popup__input_type_job"),F=document.querySelector(".elements__list"),H=document.querySelector(".profile-info__title"),M=document.querySelector(".profile-info__sub-title"),J=document.querySelector(".profile__avatar"),z=document.querySelector(".profile__avatar-button"),G=null,K=new r(O,".popup_edit_profile");K.enableValidation();var Q=new r(O,".popup_add_card");Q.enableValidation();var W=new r(O,".popup_avatar");W.enableValidation();var X=new L({requestUrl:"https://nomoreparties.co/v1/cohort36/",headers:{authorization:"b18f91bc-91b0-4a91-a711-318fa430706a","Content-Type":"application/json"}});X.getUserInfo().then((function(e){H.textContent=e.name,M.textContent=e.about,J.src=e.avatar,G=e._id})),X.getCards().then((function(e){var t=new i({data:e,renderer:function(e){t.setItem(oe(e))}},F);t.renderItems()}));var Y=new C({userName:H,userInfo:M}),Z=new y({popupSelector:"#popup-edit",handlerFormSubmit:function(e){X.setUserInfo(e),X.getUserInfo().then((function(e){H.textContent=e.name,M.textContent=e.about})),Z.close()}}),$=new y({popupSelector:"#popup-add",handlerFormSubmit:function(e){X.createCard(e).then((function(e){var t=oe(e);F.prepend(t)})),$.close()}}),ee=new y({popupSelector:".popup_avatar",handlerFormSubmit:function(e){var t=e.link;ee.loading(!0),X.setAvatar({avatar:t}).then((function(e){J.src=e.avatar})).finally((function(){ee.loading(!1),ee.close()}))}}),te=new S("#popup-img"),ne=new B(".popup_confirm");function re(e,t){te.open(e,t)}function oe(e){var n=new t(e,re,{handleCardDelete:function(){return function(e,t){ne.setFormSubmitHandler((function(){X.deleteCard(t._id).then((function(){e.handlerDelete(),ne.close()})).catch((function(e){console.log(e)}))})),ne.open()}(n,e)},handleCardLike:function(){return function(e,t){(e.isLiked()?X.dislikeCard(t._id):X.likeCard(t._id)).then((function(t){e.setLike(t)})).catch((function(e){console.log(e)}))}(n,e)}},G,"#element");return n.render()}Z.setEventListeners(),$.setEventListeners(),ee.setEventListeners(),te.setEventListeners(),ne.setEventListeners(),V.addEventListener("click",(function(){var e=Y.getUserInfo();A.value=e.userName,N.value=e.userInfo,K.resetValidation(),Z.open()})),D.addEventListener("click",(function(){Q.resetValidation(),$.open()})),z.addEventListener("click",(function(){W.resetValidation(),ee.open()}))})();